[gd_scene load_steps=12 format=3 uid="uid://b383xrrf6880v"]

[ext_resource type="Texture2D" uid="uid://dh4egsedbli6j" path="res://scenes/cena_01.png" id="1_2rcet"]
[ext_resource type="PackedScene" uid="uid://ceky5wkg5dn1y" path="res://assets/sprites/player.tscn" id="2_51l74"]
[ext_resource type="PackedScene" uid="uid://js2n16smpuea" path="res://inimigo_01.tscn" id="3_akixa"]
[ext_resource type="Texture2D" uid="uid://bjigmyoswhhn1" path="res://icon.svg" id="4_7mxbm"]

[sub_resource type="SegmentShape2D" id="SegmentShape2D_wfi15"]
a = Vector2(1085, 2)
b = Vector2(-1, 3)

[sub_resource type="SegmentShape2D" id="SegmentShape2D_ulvw7"]
a = Vector2(3, 753)

[sub_resource type="CircleShape2D" id="CircleShape2D_6y6ve"]
radius = 53.7587

[sub_resource type="RectangleShape2D" id="RectangleShape2D_11kvp"]
size = Vector2(130.5, 77.5)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_wflgr"]
size = Vector2(58, 83)

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_771gs"]
radius = 23.5526
height = 134.191

[sub_resource type="GDScript" id="GDScript_p6ngj"]
script/source = "@tool
extends Node2D

signal analogic_chage(move: Vector2)
signal analogic_released

@export var border: Texture2D:
	set(value):
		border = value
		_draw()
		
@export var stick: Texture2D:
	set(value):
		stick = value
		_draw()

var joystick = Sprite2D.new()
var touch = TouchScreenButton.new()
var radius := Vector2(32, 32)
var boundary := 64
var ongoing_drag := -1
var return_accel := 20
var threshold := 10



func _draw() -> void:	
	if get_child_count() == 0:
		add_child(joystick)
		
	if joystick.get_child_count() == 0:
		joystick.add_child(touch)	
		
	joystick.texture = border if is_instance_valid(border) else preload(\"res://addons/virtual_joystick/sprites/joystick.png\")
	touch.texture_normal = stick if is_instance_valid(stick) else preload(\"res://addons/virtual_joystick/sprites/stick.png\")


func _ready() -> void:	
	touch.released.connect(func(): emit_signal(\"analogic_released\"))	
	

func _process(delta: float) -> void:
	if ongoing_drag == -1:
		var pos_difference = (Vector2.ZERO - radius) - touch.position
		touch.position += pos_difference * return_accel * delta
		

func _input(event: InputEvent) -> void:
	if event is InputEventScreenDrag or ( event is InputEventScreenTouch and event.is_pressed()):
		var event_dist_from_center = (event.position - global_position).length()

		if event_dist_from_center <= boundary * global_scale.x or event.get_index() == ongoing_drag:
			touch.global_position = event.position - radius * global_scale
			
			if get_button_pos().length() > boundary:
				touch.position = get_button_pos().normalized() * boundary - radius

			ongoing_drag = event.get_index()
			emit_signal(\"analogic_chage\", get_button_pos().normalized())

	if event is InputEventScreenTouch and not event.is_pressed() and event.get_index() == ongoing_drag:
		ongoing_drag = -1
		emit_signal(\"analogic_chage\", Vector2.ZERO)
		

func get_button_pos() -> Vector2:
	return touch.position + radius
	
func get_value() -> Vector2:
	if get_button_pos().length() > threshold:
		return get_button_pos().normalized()
		
	return Vector2.ZERO

"

[node name="Tela_01" type="Node2D"]

[node name="Delimitacoes" type="Node2D" parent="."]

[node name="Background" type="Sprite2D" parent="Delimitacoes"]
position = Vector2(640, 363)
texture = ExtResource("1_2rcet")

[node name="Linha_horizontal" type="StaticBody2D" parent="Delimitacoes"]

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Delimitacoes/Linha_horizontal"]
position = Vector2(-2, 719)
shape = SubResource("SegmentShape2D_wfi15")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Delimitacoes/Linha_horizontal"]
shape = SubResource("SegmentShape2D_wfi15")

[node name="Linha_vertical" type="StaticBody2D" parent="Delimitacoes"]

[node name="CollisionShape2D2" type="CollisionShape2D" parent="Delimitacoes/Linha_vertical"]
position = Vector2(1078, -14)
shape = SubResource("SegmentShape2D_ulvw7")

[node name="CollisionShape2D" type="CollisionShape2D" parent="Delimitacoes/Linha_vertical"]
position = Vector2(0, -26)
shape = SubResource("SegmentShape2D_ulvw7")

[node name="Objetos" type="Node2D" parent="."]

[node name="Pedra_01" type="StaticBody2D" parent="Objetos"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Objetos/Pedra_01"]
position = Vector2(284, 262)
shape = SubResource("CircleShape2D_6y6ve")

[node name="Cemiterio" type="StaticBody2D" parent="Objetos"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Objetos/Cemiterio"]
position = Vector2(72.75, 193.25)
shape = SubResource("RectangleShape2D_11kvp")

[node name="Casa" type="StaticBody2D" parent="Objetos"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Objetos/Casa"]
position = Vector2(36, 57.5)
shape = SubResource("RectangleShape2D_wflgr")

[node name="Tanque_01" type="StaticBody2D" parent="Objetos"]

[node name="CollisionShape2D" type="CollisionShape2D" parent="Objetos/Tanque_01"]
position = Vector2(437, 75)
rotation = 0.523599
shape = SubResource("CapsuleShape2D_771gs")

[node name="Inimigo_01" parent="." instance=ExtResource("3_akixa")]
position = Vector2(667, 335)
scale = Vector2(0.3, 0.3)
disable_mode = 1

[node name="Player" parent="." instance=ExtResource("2_51l74")]
position = Vector2(808, 338)
scale = Vector2(0.5, 0.5)

[node name="VirtualJoystick" type="Node2D" parent="."]
position = Vector2(91, 543)
script = SubResource("GDScript_p6ngj")

[node name="Action_btns" type="CanvasLayer" parent="."]

[node name="Dash_btn" type="TouchScreenButton" parent="Action_btns"]
position = Vector2(898, 473)
texture_normal = ExtResource("4_7mxbm")
action = "dash"

[connection signal="analogic_chage" from="VirtualJoystick" to="Player" method="_on_virtual_joystick_analogic_chage"]
